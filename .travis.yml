language: php
php:
- '7.1'
addons:
  ssh_known_hosts:
  - "$STAGING_SERVER"
  - "$PRODUCTION_SERVER"
before_script:
- echo -e "Host $STAGING_SERVER\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
- echo -e "Host $PRODUCTION_SERVER\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
script:
- chmod +x ./scripts/deploy-production.sh
- chmod +x ./scripts/deploy-staging.sh
before_deploy:
- openssl aes-256-cbc -K $encrypted_2b0f3b697a2c_key -iv $encrypted_2b0f3b697a2c_iv
  -in deploy_rsa.enc -out /tmp/deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/deploy_rsa
- ssh-add /tmp/deploy_rsa
- npm install --silent
- npm install -g gulp-cli
- gulp production
- mkdir -p photographus
- rsync -rav --exclude-from='.rsync-exclude' --delete-excluded ./ photographus
- zip -r photographus.zip photographus/
- rm -rf photographus
deploy:
- provider: releases
  skip_cleanup: true
  api_key:
    secure: WIxzh1O4Gn6TOSZ35Wlwjgz1HlLTVAr9IgLsh1fzi1w81HLrYw09YeS6hfJDVw4JdWXG2n/n7rSJ93hm1XOauT0bN5yXNpElJR0kjPyV+oQiCwZcEqRfXX/L1KwdPdk/T9TTjFwLI15YsNbWhI4Hiehm5V7MgNtvavZRiCvU9MnDRDXAaHnJcEj8qIUJUWmsZwx8EsZ8LSl+vPzHGeF67uDVumoE5f9KDH4Y9Yp1Q5Ta1kuFlL1CvCJq3QoDxWw0U6UsgzB3j0LpsBzdId6+HIOmTABiTJhNbtTO31XYxGsZxPZqYsplEO+gzxAg29hYjv05cscLgp5Y9KTR7AOYIb797QlRtbxBGnEU24Go/85nxfJk68DUP3pMCNY/g2t+vVjTR9Qu8vhFbbMSnmPYO4nX+Hwox/R9DGrGQJlN5wbl7MSv9GGWdEZdEd2L74/XyS/ZXQjagJ796es6KpX0wDc4GbDt6tr7NQ6TOi7RDb5XtvBxMDFM3XmsgwS5TX+AVQAat5PGvXDaEGtWRBM7c9MylkmAI4voaAeE9mjrEimKne1ooAM3jg7F9rv9Hgr3ThhvLJSYBz1WbW2ksS0EVbj2L/XbUzXuuI0X6o2eRQgotr5MrOzRjATfG+MU1iVK66UQDmocpWVM5rAAqJTSrJAwV1x3ZcM0Yn64vm885sg=
  file: photographus.zip
  on:
    repo: florianbrinkmann/photographus
    tags: true
- provider: script
  skip_cleanup: true
  script: "./scripts/deploy-staging.sh"
  on:
    branch: master
- provider: script
  skip_cleanup: true
  script: "./scripts/deploy-production.sh"
  on:
    tags: true
env:
  global:
  - secure: 0hPqSlqwlWiHiTb09hrqKVLiU/xemBR/k1SWmxMJkPws5zzLxg9RdEisi/JPe4W+hzLiyHPqqeqL6/hSM8LNiy2YswYY2LhReI6OO8x58y+g1fv4lUZ2HRfnEOgutME9tU+S7HX+CzuiK3DFLzIOi85UPFl7N9S8qCkwbsmEQ0smkfEwDnQfzS3cSOTsm+DThWs5X6Uj04IFFkJVXgm++fT30WfMcdc+jnk8nCeoVvx3ngPRr4pvq17XxW/2MaXm6uQefjwR1CK/IhDya7j5T4mrJKwPom/4kuoCvYvQKW4mfC+QOnhUkR4qo9N3TyTG/3QKs09QHvOeqq0jTelFwqhq8kdZj3pYfbENCf3lfkJ0uW1xJbOWdL54ahzsnfd1Fz7DRJWbZq4TzWZlqFGgztp48cM8+yqndnsW1VfYv9awr7oS74i7CD+nkKbWePVY3vyfYVfWRXXHFgCiqT178yQMjOITTBx/NYpRA7Wb9ao/wQKc4zh9tLAX90VS7V3UTuU+sGB/mm1YL3eQuK9if4S/U91NVwjEWdAFEMQmrnK3sZCg2z35gyOEB/Y0ucb+5AD7hhuC/Njbxgv2smfRnofn8hu9W/flvCwCHq0E6ddAB9bWxKT/mpk8LGayyQ0HiO3AG89i2FMdnPZrB7V8jW5F53hChCvUcn9EYpqcnu8=
  - secure: KjFOhzhAMGsmacC5VhI5M56lAoDN/TDrWGTx2rlSNUqyC3dPFysyVfybpImWWcuh2/RO+xaCB9yfJX4CNPAnZwIpgzfaJBGC0m8OAuABq90P30DyUP59HQqqdYgelVASa++kjc4YJ1BFDYpjtIBZYN+B58FyHn3Vs4Fquh+nDJhETgLOBFnM8Wv/5qjpKBtXiu+bvuVPYHa5iN0kXaiwd6XG4gSY5GmxChZtEaPNpJjoQm48IunG7sYS0K+H9oyXjuQ6fA1n3OHPQ1IvfE+A6jenGXgMAXuJSsR7oWlpbjzimLm8KzKMqjoNgDYPNPoDUqeNJV5G+wvaX2ZhEZ0TH828CDnY+sTBhafdc7oMGTWcKn2I8uUJqzDir6++mW9ohO2TWnT2u57l0Vo5M47AvPC+SZpdQzGmUc8yCj61j5zilj1H7Mn6Rl1PFfewUxcEKx/pFtJhEn1j23n4Aoa6Xxm/pJJHwsepY+8yHZSb2dilwzd/vqorK+IuF+x5tj5xXPpyaajm+T227D/vUPYyCu2dWADitqHl1j/B7qevpgJhn5itFsR3Xzl4IKnPtubnLG7XkCNlpbwncNXTq5sXsijIwYITpEgcYx9nLNjZtIsZT0RoEF4VLw7BVgQyx9Pbbw4gAk/y2cwRcZlmQ/3KOfqA/04Uoo1M4QCmaDviubs=
  - secure: 1QtM6WO3Bzf3ItWwU/N2OCBRWiDc+bNXZJ/gUF/PBasL7/Np9xQItDWQARtyG6W7jgCtkcV4LVdGA87TuD9fxTEn7iYo5nxLwcf3r0EdkasOhAJZKX7RaAKoGg/nLwoJHFIDste5pTmVWVe164wgCChkLNgVvp8Gr63j7mjEw3/qek8+Oab0+0tI72aYMkI9hAAphr7/ZhCB8nBSG7r6dZqmHebXt+xpaEAWGbWHv7ft0AI/A7pE8T4uvJh4nUpKWw+mrotHiSKvcxb1LHeSdrdKhlljrFwxN7oLOoGx5VvELI6e1zuIeNyfnV3OakGqJ8ME+/fwYYGtzRKdnSany8g3Bc/Bx1rIoNKRpgE+xxyWZd+wI16E3I1BOzGndoPzSvEuBFcjCBAAh9TxvshH6W8Bi4xDfU8PtL/NhKTAM9jdfcYOhTJu4uRc/qseLHxnV4dmd+jWJG7loUnaRT+mbasy56SHMNOe/KrUmfS8KxsNqQbU3hSXLGUGYhVmH0pE9ZNqKPiIO1RIXfa8tOq7K4rYax86DaAa3/zH67TMMFUZMqVP/hORW6SQhFAccU6QssoSrCRmqJpo7nnhsCCIMS//fUR1TosHlu4Mb87EEOfmD9Sq2roMmH1WEPye2X1x7g7Saxkmzsh4ZM9b3mLZrWOysIPT3LfUcNDQXppqZlY=
  - secure: G1YD071Qb/hL/h15w1BOCRLomg5bYd/YsG3D/tW1yMEs8xNfiXmW9KZRde+geW9URKArAOFeWD8dVLRkyt5FxRHSyEahWyU5fozIrQ2JsHabvTzXBkgwqvJsJWf038JxgAT6F/NeqnDZZJ5Z9f/F1yzmbIoYBdXOw/HgrJ1xc0IewRN3PycWgOdsenYyLreCVOF10yzEr7mYI0PbxhaMLT7IH7QcncUgNkuSJKiSm4J/xDo5G2T/qcRczmkotYbuhOUyylMkBSmWFzzFTm4cjcm+OR5y2DiQOtKUZOMo21Thpz0LzpWQU5qICUGxvsa65syMT+ohuS/rouo0Zep8ltYJmAk3YRvZETgDDv2RPmYnJ8fobBR6xkt+1FzydhLbgdhQqM3vJO7Z9FPyfzmJXwpn7zPeQxMydGt2/KlojYQeDYUOK4wETAmyCHr1jkMoQUMQQMz2syJEl374TbpunQgsoT/RRST0Sh26fRn16wzyjB0fHl5kkiDWYBqEkJmrqSeiBELslRUxylfMJxAxudoicAJ9k9utnFq5+yIePqDYQOVwi5FqBTZf8L1XJF4B24aP+64aflmRU1GzHoWpsIrupVh0C2q9pXZ5h3tKoLaPDZhUHaN+QmpnINZHaG90r1aj9gXXihBnGezcbOAIOlmX4OEKi5Oo/rPuNCjY9o0=
  - secure: LMeEssf5hncEBqJ21HOeYP7OKc4NbOkvK8KVJFJkym8GoYcrakXntEN370Do+vOKSRVrrYJKg/H5232Kq+I7a+cRuU+FHWOuvxxXgBdCFrdb8XKxkeHbZtsMve3xCkPlo8whMfY8fQ22aDKIPWIEPjcRYgEO4jl7+zS04OhNt0BfDrDYBHFUfV88pvP/YLdo3TK/S/Lzb9uUcMvv34KNVXItdBoG/6EvWGOA/LGgK085LXSLtMad/bxSy0cXo3hazXg7eeY6Xz3FZ+ryV5YXFAT6/nv+u9MuLYjS9t4V4vr/F3zWY5lyX+QVmfmIJ8cTj+D4l0GsZq+NbYLXoWTaFlULXdfc4Y3AFIEPmymb9rvhZWgrb7rf/yKea7FoN4EvSTPkNdo9mA3/XV/dOqydm9yPQF7NUEywwGuLg+sSrUVLlFidm7Nl8ubnHK2Jk17emE9nA5/NIPhbVdyDH2C9A35tpUGlbIBJWdO03Jebtv9+FwDTxz40E0o9yWzW/kNd7G2MQQfY6JPfmop7bzh6UcBWcYIctFnV0nKc0cpsU/eqdjohIKLyLzkll2z3HPpZE8DuaFzE1bPHuDRej1kA5C6xilAMhtocFDbOnWNTVNIq+FqwU2QtbuFolMIWFXDbt+jbH5Nu8tcEB2SM1jyqu2OixZnCWNma7LpRb7ekZEk=
  - secure: 39Tf2lSYzqwWq3T7RNbvxXAfohLdhC4gw27fxfZqCOGSZMNwbaVGkEAJLlAItJH8R1yUutA8984p1+7d0f7eVnAV3nIBhu7EBL9A4ECbHUAEK7Ly9Yh9mYX+IFmyp1jMkO20iunOnri7ZzOEnxwW7heIjNuXTALDqdd5SjKz+qjxN9Fu9llW+1QyuTD/EHLSMz57HW9mJLh6N6L/pZ10fMpnw5wjZJRiDr8bHnwGozqKrYbU2ecyS7+x9R1fkoCkJ8lHXG5iuoXnq/nzs0Wk4IdbUQlKzHgHRdO5QCjiVQQ1V78+tAzTMEAkIUx2hqm+X1mcJbsTv9htKdICy+PjPseEUm9RWpG7/kQDiJ04M/bW0gHPe63zLVTBEwom7ElaguWZGT1RdxazlbQnYEw6/fyMQ/npUMoMLV76JY6PbV3OuaGZ5vaTE2Mlrh/FPrgfBA978sfV8P6PbJC19Rg4n70UQtvzIeOKyuOA9AKw4E/bhUIoCWAYImpf9F1xQ55vLsfxc0l54c11QIQHgnFFhCb9UzYg/7WrBuRH8YCprb6mVxKDOxbWTDGOZWaFFnQUHoMn2zURDykvxsWSwfb6y/PQm9ggALZ1jensYRpNTjw6mQ2odC924iAQH1Iwg5UzCkyT0DALxh/n11djP5TInf3ZSxvuTN84g1sC2INpMy0=
  - secure: A2tUY6M7oQnIdbyqYuWBZQBjhZpAzWVdvHWk/Zy2Gyhq8SO9SjKkSRnHeaCBccwo97pB2UgtEYSDKIo+imrOfHNR6yxnuM1yhPZ9TMsKL5VsE0CzkPAxDtc+eKk/iUlNeWaSUOqZcUdHeqda+kv8q0a6UrcnmiRjhFDWN+SRxXHCs0l23G9RZBRpieUbXha1CUzY5SQ+CFHRiC87CjcF9LoV4MiD75OphcU3o3ikP7yTLdaiBmXout2H+qEFUu5U6wDl4ddTnL6UPBTVfITUMlSJmOMxmFlSJnjBAD6y9F5sDnfe1WuR1lUa1uNTpEc4mDVzTQRWS1kpNjxwXS2+3PFYtdtcshJE1Ys4+ftCZ9TDHfaixFfh9AIa+OfhkOrTv1RQDIyQGV3CG5lVxODHILhmWNJLUS7McYv27IaJfFYolSZ41hJqmGhDQqbKYJACat7iRokSC3AZGaT8AES91JPHh+pEAXD5wClbDIBJV9UIBhGLhIGSc3kKN/bJoqnvZyHeRkZPhZJSMisczlCfD+bl8G6QB12AiCCdJ4LssipEIeKzdoHZQIB48EKO7SYiTQugnPMenLZK+OQkosNJ3qGZi7JmVAO+JwYtgNfw+DSfz9gGC6cG2fij3Z0B1+fxtqaKxQF3rzVSm/inG8N0BGEVElbR9Thv7pR/a8NCF8w=
  - secure: eH7Lt52FelhzAN7+2p4qj7RZ7AjAjL+qUu+RqGlPzb8bS98n2Mxlr9QFcf++fNxiRCPshWLkXmNQ5c2lQysUiRyd7d8Rk73IjyWGouSobCR1gS7ymnHrQMAToZWFG0er5LB0v9MEnDxIVYMqR1J5r1gk72rA2wOUvnP5spQs9lub4Dmr2mhgaRQxzFIzEE/YX/h0za8WwQaZmik78ehguQ1GEGI66po6ySsf5jcPvi4WLZO3bRFLBFUiYXiwVjwywWFAYDrRlEvLDZS12oGkpcSKM8b2+HFNHo2EOXx1MFU45itwFHkZPHI2sbxT2hujWk+OIytj06CuiqwQyH4SWoAznMy7NJSldQaZwjMZvXwrVHdp1z+fpuJC4YnhlvQ6qoawczehS9FSBH2kwy11qPU2LR7glPN910LaM7tV7jLheFcoDpU9VpqHnW+dyeCZnjNygbCxeHq0vnNT3PpLJfiCncOWDcDC32I0Dfb4tMGVhGBAbWAgtJQ872dtdVNJqzQEshfj8oTMQodrvPinriLlDxHwgRgk3l/UrVUwaIjWepO/h0Q2tBqZBS9iW0JQKZebOHrdYz0fCrGSbTafh8w/INqG5WVFvT6S3NDuEExZ8ctN9PBgutYQZXQAFkCDjSpvmB3F9OCjlsIlw55sYOqGnXPp67XFObKanRvwvyM=
  - secure: QuJxeWmHWWrfOXEoPMo/6S6zLra40D/G12MDXATDXp9PUpWtr8ROPnMiJapNQzw5etIXBJH+QXIzcdQzInFl88KA5jvz2g+F3IqtDSaWQewlt7gf8s/cTD2X0FBTb9ZQzWCsgkD8sKUhgGJ0+14IAG+Ch54qMaDQE+WgpUg2ZsXy1bIiF0PJgNGUxhsfyuUpT2FoQhlT/9Fue86J5qcGqJTpgZiKOpTPAes8BXT3y848yd/nQs5KWIMMzTZsCSeRDPlpdgXEzWJP2SHCk/UNl0I0lXgajBOll7fkxILZmDE3UIAlRxZ5hToG/WrQiZUFtAOduVCynfQVWwoM+KH8ifv+Q2tXAcbsM/O8sx/pAG5UHFwr8wMJcrTEcFjcUV7eR0L1sB37AXpCHQOzexO/N+opNsDlmFcVDoIkIh5O4D4pg+ywgV+0KUouG0CW0KGwcA07HQRoQzwAZ69Q/CrVsADyKl1uU5kRKg1ceIm53iz0Qk1AdnoVRMrKi7MjDUZvN8SooiSNDVK3E1ocpTf1lf9DI8U5Xyp8I1pMBTGTJiM4gAKTOew0J/Us+PqnbW3zc9navBMI2mVQfeI86iVpOnvC0+oIWyhboUCmGQG0yUWyR+hf+Zb++aD7LFGE3p00hkMh1nD1qmnh4oZoRPeNB/oxPpngJnFR0X1kBw/gLkI=
