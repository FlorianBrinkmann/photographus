language: php
php:
- '7.1'
addons:
  ssh_known_hosts:
  - "$STAGING_SERVER"
  - "$PRODUCTION_SERVER"
before_script:
- echo -e "Host $STAGING_SERVER\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
- echo -e "Host $PRODUCTION_SERVER\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
script:
- chmod +x ./scripts/deploy-production.sh
- chmod +x ./scripts/deploy-staging.sh
before_deploy:
- openssl aes-256-cbc -K $encrypted_2b0f3b697a2c_key -iv $encrypted_2b0f3b697a2c_iv
  -in deploy_rsa.enc -out /tmp/deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/deploy_rsa
- ssh-add /tmp/deploy_rsa
- npm install --silent
- npm install -g gulp-cli
- gulp production
- mkdir -p photographus
- rsync -rav --exclude-from='.rsync-exclude' --delete-excluded ./ photographus
- zip -r photographus.zip photographus/
- rm -rf photographus
deploy:
- provider: releases
  skip_cleanup: true
  api_key:
    secure: q4HnsOAxs/otO6Yj/ziq+ofcSmnMELujrGIelzGZJr0trNq3jb3XR/opuChDKBy0Ldc7ZEg7OOSp+emXkOmIV04XvX4+5L5pEnQOkZ+g0+GGPGWyuMoL+aRNnuAQtQk/wLh6+vvfhHHET8E3C8+RvlZi94SNdFm7Z/aCcQgfyKKv1G44en/zZs0Qd8o3TfvS5wVknhZwPo/lzwdiDr5/0aEPJsZ23NbnVGwB7FOovpMy4OVCKyCZhEDLTqlfptkix1Chv2iz4kBzxoPYleOaKcoEAyaiGz/XlsZYnIPI9BT83bqjnbqfZY08ycE4hWUFUHF56XrYUr00ZGUb3GtwRtbpNqK6P6Qd+gw3VenWWZExgwNR3mceLmDNAeUNBkKezUmdiQiioerG/GzEuobWZhtSY3qv99YznbhfabdIoYi4LzCKzVRAw/ZzpMQ20qHAzPNdHII5nl1tBm3TWlQL5EpxrB+1nVixvKnOnC0bUMYEo52Gb+WcL2cNTpCe8jSzmbSWpAtgzQpRkVZSPmBNcvaiHziltzbija7nRvK9jmWh1H58p+Tlvq0I4fSSLeASQFj9VZAoD9qkkj7Nep0JvMZ7NzpGcjmY90JqkTElIW5K0tQbjUbHXIQgsnO/soiMxDbUJxJVUo+qNO7vOE6NA5vkEzoKjky2ttHbXW+jy/4=
  file: photographus.zip
  on:
    repo: FlorianBrinkmann/photographus
    tags: true
- provider: script
  skip_cleanup: true
  script: "./scripts/deploy-staging.sh"
  on:
    branch: master
- provider: script
  skip_cleanup: true
  script: "./scripts/deploy-production.sh"
  on:
    tags: true
env:
  global:
  - secure: GNsYMd53YI9lt2vjhOhwfrzQ0H2MasI0ixNud0tyYcEYzfzCzeK88iRKwxbAmhbZk2+tfxxuqi1FTkIJmwLUyZRqoPKBZWavPu1M5aP7ie9NzOIZJUvqpwOyLcPoYx6kYspFNTTrs6csiq+uWq6+CKJNdj8sbBxNFUD6AcTkIHAoB0duFi7cpiL0ebACvMVc1lZ70fLmUZINZBYgKNJ2nDfVoLkWQ0MDAV8se85xu7dMkDPSiWPpTBFJc7F2A/x9y1g+lA4ZoNqN9zAPAAGa59WbhoAVCwbwdDG6FFc3maZBDQFnYIVVBRVjOPyBgVE9igtoOL5ILYPhnsLIUMxKxvK6++dggE5aPibmWVFDGP13MCPRSHa2nNQFccJRtZ8HfrI381aJ7UIWJBO/hXcR64K6/4Jlq/WGiIgIuDFh+HWrGpeQLU5Gjyew+apgOVZ55yO1rv1zVqyhyTFayAYeylcWD00kCTxqx12Stw5gSFQC2PUWX6sHHMfER4M7DM2k85YxTgcPYQBXPicChq8buuMWl5GbKyAx9TJNKVaDSz8NUEgIhmMhNDXhL0ya4nBNXMMQXgbg47GCPi14R0HU66sfRAvqgnzCKSauZ6oTA+YfsRBTg2NI7uTIHuGeMkMg3f76uhlpZ0+dcVVdwCRBT19VDE5nun28DrarIbYNuyw=
  - secure: B+QmEN+j4e2X7ooi0dHqcU9bmkjeZNcl3TrTmnzCWcyj/2sMTIvRdJZgPlLBQg0vmfODxKOv8wS8n7lYchfM3wXt7fYUxCc91akA4nU6TSROFXRDqo7CXzXgHYjkuAbrTrSwhOhy28Z44xZD9as9oGLmLdzYNr+ZxwiQOP4LnI5rm9NNlx/4b1/VmQccrr4huERifHxy/zE2F3/V820veWZZ+FyB6MXmE0M4ZKt1cG8il7U+fwGMIb2DVPha7PfeBmDcf01i0fyDUPhYUkIymlZGyzkADCG+Kt1cN3KNjhIb7gmz8QLqjNrzIjmUs0G0Z/HthuRHi6b9nUJGxHs/ZO2JTNIpfflUQXIlwyCGXpp8p4KzJD9lJV8NZzAjHum6DmVOZEPfUWkkKq00w9Tqe5rwt29QSRNzFW5ssraBqD794vh8I0U6GyJBxT8KFOlGo/Pij4J71RyPMVIIlvFcTCT1bspZjAGr87D5dl8tVRMmuWE3rHBmug2g8DPWSjfqc74bmZQ4UhTLca88F+a7AQ5Y44fMKj+18rHdsA1muuObfK1tAuOtqvuzey0llhMhNJeb5JqMa8JW+Eu3J7pvp9Ug337I2JyothmyVDIUiROfe1Km61fxtflFCdIR/v7AffNauD1SmySjNYeWOYb3JxIEcui0ZStFNUKpqdJdPiM=
  - secure: YHUIfVoWydQDdIL7bMQ0kJvKMKxb7bnYcw3gEs8+9TLMiEOdwPrjqr6TOQC6Wuwibklg9hx9k7rvXxJctvLQEtmN6b9NYG2L4jJirit1VfzEapRBBFjx+F0xW5RMRPsdCMTCfYSU3Xkt9JnKH2jxKL2YdQLde5mKH8OvKH7nGqWSxTmv71URxelSoaEH2L8DgrBnW2zsTuWIVio/GikNvS76/8/nY6Q5jO2E9LOvfg9YtENrPmP3EdGssUN95eL7gcD6OX8/IXQgWw/cQgxwa7tBF6sPofi1w4qrntuofGv0KeNHI9XwYFeT1L5twhZfo+eLqLXjWwXTMCYMpaWAp6X78FA9G/fsvTI+SsMV1oM5LPDxKBrf1uPnZTicblyUHWNsGg0CVB1SopCtWnn+FYKCK+HmxwweccclNRvXpAimibh0fki3gU3QJgRdqSOoCSdoQNCoKcQGzM3/h82MtBIOfMQOiA/OLF2h2whSmGeiE705eS/P5T/BZNEljd3bZ02InVSdWA/MxdD4CHUfyVtYVE7Sf7QXMlFQoEwLpENDqQJ1BYVoXy98TDwk/zdEaj5q55rPy04zeHwPYApTwZNf74Mo/8L0sVqcI2kg0wqnkFpJVdKstwVe2cwFqyt+McPnqdjCIl1XHz5OSxLl+eWpLBL/7lNu/N8fc5fPTHY=
  - secure: rq2SGKzrRZnMCtBFd9C26zZ03ZBrt9rFiaTHsC/yom6RagF8iMDuMiN7K68MPqeov3MFGW/eHq3rq9PF19ZoFestc6WqhFpkdCsFF5kqRWDiAIc6TncEVwfAtmxDekEMLS+H74GvBoQUfntKxUfGmcum3aeJPwT77T7QYMYD9oPmt98nD4hQafP6Mz2SFWn4CrkJeiHD507zXYNyPMkA2alcTm9KePTwNabqavlOodMQhi31AYoi4/z++UOqd7JFdHWa0isJLU0YN9QwvbTzezol0RhUiS5sebTaIVLZojliAliYkxnU+gsDXXoJ3OlWDso/DRZJiIqFNmLMbYCbcygpq0ay+/aP57sKJjgw3WyqwE0ZBVXnTHVC1xLyL4D/xuyivMIznxy/Xba4CpuX4ONpeZ3A7RF5BanalfM6Pg9utBGB1NkS33ynZ6qaCGZ5zkSuHHPLdFH38hAUyUmRHU4vFWsMmULy/jrkJL/eLaEA5nhx3J+zn4N1MuoMyczHZV34YsLgicVSWw5qZkLuMGUrn0xThYY/dO+QptLRt4PD+dlJovPHMqP1ooA7YYJHZj8q5CNHnzqMZjfCI2nvY4KPNAMnFQe1LGDK2kfeNjH1X7HglCT9MP0D+E62lLENI+WED6zxvFrZidrLHiSJU23tlenLd8PL3s1JLqUUVHk=
  - secure: 2xPLJL4eVghPdl9p8bJcjMsT2NgSkWhXtRFG108X0KTeLRnMWy662CjygeLsw6xgUfEG7ofFTtcdWzjJXIQqeRScAtUPe6aV8e2EbwZc0G6bQ4bjB5pSAn4ZZ0E6CLlL837S06DsSVPH2Dc46RkEWfhyv3nTYr/HnygukuOpmtlfVdwgIRA0nAoPSqlUotqjHr9/6mVxkLnIHwOm5fPXYf0cZyWwPD3JN+DoEaglJwEFizi9DyHV+exzzUexyBgqWHx0w0BiwKHsCoJ98B5bhpCYMqCm8Q5jHIT9vcR6KTSiha8yy5UGrC7kRe4LKGVXJSuLCvRUrdWqFCCtZ2Tl7FRBbevQDjelpfNrwW/JQdIpPKHQABRep2niALTFUJmoQbPXarVjEQhclI2SWKf90NtHzsnkyEPol8465HOesTrD3xhC8+IH72yE1qe0ZqY12gSHUf8QkhuASFtrw2DFZY47sReLkbSXqWHac9WKgkr06rWvG3MXREl1/HNEKeWrG1OCn8kZ+26AEzhzx0axJZW0baisBHyKAz9GyxJrMufKeOMdtRixRxqIW6nU/pfLCfqmZOzByL7f6Xqs+Z69z4qUOrGDehBBFqT7Os2c1zo6sSUShhYpHYcPcLw7g0cct7lw28LhuuI0waPjNN8Oc7yWViJFtd2NRJycznjA5pQ=
  - secure: pXhKK5RGkVcWTqpRzXJAJlE5q2O82NPXTk+kmCu63A+LhqYXhK+YqcTeW+iARCen1qUVuECaDLbB3JBqvYkqVs23+5e3WuVaBMmF9hlfkhX7qK5FIItyU0XnDqkbz4nLYgE0ZyFww+Ymm4wPNWVK9Q1mPpKBVK2WbbDqqSuKHanoRYevIrXVI2I+YHFSQH1Q/PbLPnf+FiLqh29noISaDM+6AvqClD8Yp5KcakBtSUGaDrG75uDOVt+DH6QoooIJegEqIlwX9XQmadK04DSW7BpUo6ix3xmeeuujL0RPIop9neK8UAoD91SjkI6nFxK19BPCp41PVN3vvF7XfjNfoM3xrNlGNj/NzR5feYQOB51H83XdEGzgrUZHxwIFbLYgmjNMa/skd18LyMR5Bg47RdWn2o/LYvxWiyKpnn5MinWHkggh+wyaYBvXmV75YTsqyidKyJcg5Sbi7HDPitO59OMMcTKW8A1KGfB2W9vBBrhuLzAf/cCkRRfwrJ9DKs5edMUzHDh2lGkRTDyn9IgaDPlyiDNbwc2sXdWEOQwXrX6PM1IhozyYxlCTtiiJsYYKedD/lMFaj91G7xLCj4H8GgMFCjO1b5YQrXt6dUCyTvGVJMBxPEc4Sv5stzsagGqQW/sOKdvrCkTGj5pkG9vAgNxLT4yfVIAe2zQ+M6jjFDI=
  - secure: Z4mrHf5XM2D096506lvLDb+EgTo3aCAwdAH+lBHpjResjeuB8U3Yds5xmDO3XfO0TaBWRckr7PQ9MxoCRVKFA1MOLZJnrY2dzvWUgE4cH4CAEAlomyam9y3ZkiNy4QXBnIAfpY/Mgvku8okYlqVWdaE5pkhLouAPnvd+52KdFTpmTsokGpZ3c/s5ElWcRNKYm3YhAGRo/2YKZhNXzxIOzhCiPKOql0UWDjzwW1mfQgPbzttC06wd5RmZHZRnPYTxxQ/jL1EtvdqhGiEa7+zFrxWAqmsY4PC6gDGUUH0HsDeMoCqFvWok9wyqlSbdJC0+8LX5Ednv1h5jH5vU83a1rQMf956XwZ4Eiou312fdoNfYR11IpyqU8tvS6SY+U2vjtPBF5cChDMiqtEp6nC1zs6Ro30EwvCE+7ATHSMnLRzZPZiglvhaQeSRB8ejFP3Ne+7CV0xI2//CMURFKEDfbQzPg6MRit0aivuZkB1pPRcbkzPuQKO2b2Hg/nmQxDnYtsRjgh0NyOyBzi8POGIWHFhr0J0FMNQV/drggSJhKfBzMiQgqBro1cU1dlTqBDeCBwQtiZz6Ntm20Mu9xdTHCrRNXoCkBSMK0ZoPWWURV4bayXQDlw/IWTEb9yWOwctc1ayYDKNGXIVAXwpZ/tUcW0bOnNtKMwhFiYJbYgKrPMuc=
  - secure: TDnuVT0yAgFqfmwrfiyf8ibmNP85wtAphXxLXmtUAG0b3UNaas95q8gUH59xs6wwO9+PFnd+bkJ94oTY/4JWCEnb8uBjCagu92yq4uJjcA7qKHnz7Fh7/XVLNZN3Vn3DJee7ZiEeCMxrlP4ZvzPWjt0W7EW4xZ4qtstePD8XweXbl7vy5pQEi3qY148ZaZP7yAxZ645fflmKEiZ7z9zdXpmBro7eUu80P1SMHsfLND7uJvHOdrtQ6JbVIBaaryTqaoZhkzCtI6QWTCjNgHIxO61FSzMWpqqTB3qu9bwTfSOScny7MrFxCCyhEwk93KN9oKCYiq411ErBGdiQB6NjB/pA9X6w1fXWxWkmDWVX2bNzJ81tZYFFJ0a0uKJPaTp6fFIY+gk69+P6mqxFOSHbNtqVewpe7YJbnEyvsri4f8Q7MDOb1MsxAOmLhZS1gpD3GbZ9l7iQqQaKAKGWoC8lCEDrlZ0rt0NHSixuMj1q+hQuPe0W0WSDPdBd6yXLXX8CRA8SS3CHK0Ga4BwLVn/2vEy9kxDC/gOGZvjDlxDcAoC4Ledg9tuT7Vrne0+Bscmslo8bb65gvevcHCu0XQZK9cTBhK/XukrH1UACGtlTo/MFYwEwpuPrJXkoBPYhJsv/Xo2oIzPPuTYUev2JXkWevd40AZyUYL87Ot2nxFphEgY=
  - secure: ZJsct48dtXUUxLR+3WOsVWBZCwc4H3a21y1FdHCzFMjXJx6s9+eYpymqygV8u1xvse9zMy+ZG136v0kT7qTCLNYlrt2sn/M25DhmhdT+aixC+IOqJv/cz3Hb6awtuM9h9/tH2kU7LZ9wtnZDRN2gIz5G3qqaI+nIEUfCrmVH4sAQgOi1zhYN6yYWYgrd9OMZpyU62skfdKwzgyBE+NvF6JQPmwqi7K1aFTO2ZMJ/eQKe6Fo8gYihomhUH1inN7wiSZka/HC3iB6CdT6vbMwVHjEmI8URBBo74D5O5UYusmaYUcUJn6Gc81MvMFtfwKFXeWi1FOYviykLIT1UXfFui5dRCx8F7qMT0ujrNWYKQ19bJY6DsFYroRhC2bQcFI56uyE5qOBNnCc6o3t/b9j6EjQbxOAP/dEpfQz4dnSChS3sg5jFU45rVSxnuuZGUtdunYXJ77bRbuy8LjuefJDnissqJSOCKUDLVF9Bs8C4O3xLHTGdS63ouOPvrCb1J0c2jY3yCc92MjUcohd6ntt4hUF1XPMes/8/OulAuyl1ZmKt7Xop28RvNyh4HbM5Jp/IqhcsxQiI+IYPU0UiNCA0gweJHbMjWoqJ+Qjp98ODChAolYQxKJMJKbff/U5CheGwI+A8C3SzvN70DPTpgH/r6njGyyxmAAWXFk90eSitle8=
