language: php
php:
- '7.1'
addons:
  ssh_known_hosts:
  - "$STAGING_SERVER"
  - "$PRODUCTION_SERVER"
before_install:
  # Install CodeSniffer
  - composer install
before_script:
- echo -e "Host $STAGING_SERVER\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
- echo -e "Host $PRODUCTION_SERVER\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
script:
# run the PHPCS tests (also checks PHP compatibility).
- vendor/bin/phpcs -p .
- chmod +x ./scripts/deploy-production.sh
- chmod +x ./scripts/deploy-staging.sh
before_deploy:
- openssl aes-256-cbc -K $encrypted_2b0f3b697a2c_key -iv $encrypted_2b0f3b697a2c_iv
  -in deploy_rsa.enc -out /tmp/deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/deploy_rsa
- ssh-add /tmp/deploy_rsa
- npm install --silent
- npm install -g gulp-cli
- gulp production
- mkdir -p photographus
- rsync -rav --exclude-from='.rsync-exclude' --delete-excluded ./ photographus
- zip -r photographus.zip photographus/
- rm -rf photographus
deploy:
- provider: releases
  skip_cleanup: true
  api_key:
    secure: WIxzh1O4Gn6TOSZ35Wlwjgz1HlLTVAr9IgLsh1fzi1w81HLrYw09YeS6hfJDVw4JdWXG2n/n7rSJ93hm1XOauT0bN5yXNpElJR0kjPyV+oQiCwZcEqRfXX/L1KwdPdk/T9TTjFwLI15YsNbWhI4Hiehm5V7MgNtvavZRiCvU9MnDRDXAaHnJcEj8qIUJUWmsZwx8EsZ8LSl+vPzHGeF67uDVumoE5f9KDH4Y9Yp1Q5Ta1kuFlL1CvCJq3QoDxWw0U6UsgzB3j0LpsBzdId6+HIOmTABiTJhNbtTO31XYxGsZxPZqYsplEO+gzxAg29hYjv05cscLgp5Y9KTR7AOYIb797QlRtbxBGnEU24Go/85nxfJk68DUP3pMCNY/g2t+vVjTR9Qu8vhFbbMSnmPYO4nX+Hwox/R9DGrGQJlN5wbl7MSv9GGWdEZdEd2L74/XyS/ZXQjagJ796es6KpX0wDc4GbDt6tr7NQ6TOi7RDb5XtvBxMDFM3XmsgwS5TX+AVQAat5PGvXDaEGtWRBM7c9MylkmAI4voaAeE9mjrEimKne1ooAM3jg7F9rv9Hgr3ThhvLJSYBz1WbW2ksS0EVbj2L/XbUzXuuI0X6o2eRQgotr5MrOzRjATfG+MU1iVK66UQDmocpWVM5rAAqJTSrJAwV1x3ZcM0Yn64vm885sg=
  file: photographus.zip
  on:
    repo: florianbrinkmann/photographus
    tags: true
- provider: script
  skip_cleanup: true
  script: "./scripts/deploy-staging.sh"
  on:
    branch: master
- provider: script
  skip_cleanup: true
  script: "./scripts/deploy-production.sh"
  on:
    tags: true
env:
  global:
  - secure: 5HNJW5a6xZg0+OI8YQZOe0VTFWwU4v/1rjOxA9iWy8ZSQQG335Dno47aiGwF5JQ60/uwF4WVHJfyKaNnTDSEMmhnBrPfszcn8m3HnupkpedoEQoM3Ao7QTZ21lXi9dTyXblYN5Ab/toDrqo9A8IhBB8qlcFlEbDi5pQgDOeCh8SNhEkLqscru5nabBiw3wpcbwQnZTFWegWPbUhU1snsCqQ149sR32t1IkERlZ2NxRw9F0xJSipy7sx6EQH+NAs3CO3f0jnKMWluX9R4f4Ag8S9oDSfpS3fGq02nnZ6RcIQVCXV4XqpFj4t7TsVRreo0V1uDc8y8eTJvA7qyFbUba/J6NWXLt7ok9R21HKPfiWzzC/4ze8dBK5MpfsELdk7B8a9WGt714NX53j4DF04+RfSxqu3c/KoImhBNQVNlQDYTZ44p6UtZTaenWavP9sU5I3Kxr7FEnTYirlK2eCRxr6cmGr6HBpucZnr9JbcXPt2p3SKJV76KBxZZwntpHEl4AbcpanDfv1BNXYJODYJ08R+glXEZ3QP4oCJv4dzy5v+m7tjY473r9d46D3irAptvdgFRvIp8t5f1sJPLzjzFKyinRV5FswonMkBYYR+tOnd5rmj54ElBlrdxlv7bg63jvFsWDGT6ppvOemF3BKW1zB+ZuU9NnyJ4A2uOByG1qY4=
  - secure: CozxobXa8Q49GpngHLvwBOswkHoXCrAHGhG+CrZ//qIEvqDDh9aoCSJEEO4QlHRVsrzZScz2JYNFIuSBlzyOfTsgWLDAu8TtjnZIPdTeM+S7ckZ7RCg/4tJAG1Xcnag5m2vzyM9fsv6HHjRhaPWnVOmXhN9QLOMFBgq0iMS1OeoQ7irxc1zPD9suSXEvBjr3n+0kcfRRtWZfVX0Oeh0SgV+ZOp8ZGZHgnqRgbCO6KPq+jynV9tT8z0i+CtR8t0kVWBq1HPcEL/shUNgQqhZbWT8rejKRRJbc4tSkFC7JFPcc3+zkt8O18w397GOK8QBUakJr3BvYcb6BEakhRbwWn8KERsFvpft+uVuv2ywe9uJeBL1oIGmBLnRD4L8rnQz6CO+uYb49GG2bjwrnnthqzEQK11uOaHsIMfYYjCgObjKkNBpYWuo+nbBTmHmOju06F1oQMqDzthheBJdLmiwd4Va6n58cpe98HXKYzx66FTWglcp6Sas76n3u/66LXeFvqVl191WPAJF06i0tyxXT2KpugiEtS5N6Xp3puMt2k4CAjnRueflRwIABpjdQE5NFnifNSPjcDcCXRAGwctTJGN97OgIslRRvuYXJ07Oq97p4BR005ZRP5vnDVONgu8zhXWaa+3hcB18ASlhtLiNclGf+RoayLW6kTkXAaRZMpBs=
  - secure: krjB4NrQ6xfruFNVA3TKTQYGoC4GsGxNWljXcNUE3NTCztJDOL1TNsqC7iGb+bTgz/armz8lUTQg+2c3xAVjpkik25XcXoz2LD7OwGId6DlRTmfb70LLtRYtQd6xdWca87ciiLRpj5dCNEaB3Y2D/FhBAQTMbkzMBxvSE+O+VBFVeE00IL+4HLIRdjwLuRW5KAB1dzZ7J2kKo6Fp9O4njRPXos/MRzvWW3lnbj7YKIu87bXvXMKzJMZ+G1s5a/gKKk8go6x2unE7vWiB+FPza86yBS2Zb8dwn+eCFYfmcAzqhh6XyLEUt0qm7lWq4QgjF/ibwEqgagww8dwfYsOW/WcrlG8iNupmI+bN//MokVpjABTGOQuB0lHXwBHqF8iYUmIaR3nFdGZtlIm2+u4ZReu8d9XyHzbOeeka0ez9Z+up9NqsY2Cnlo+zXXP3XA5ZSZMxn/lSxjR3iADEJ8l2eKhx2TCpXIEsI2gpsq+zFVIXiq1+qM2pCVdZkXvQ2NDs9upFajwvJCfzn+Px+ONIbtmr0/KLOtV95BWbqRe7WfgakAlt+9Y/0bpYM1wnpBXCdKwzCkq2hFmJFV8RE1lxCKj+0u7nF5aHBv0iMTxrZKYkgs5W/9EhAvbDBQV/S0f6Jcu8v0Gg0Vj4j94Bo0Lm72jp0gtCPjrGpWxUm97Epv0=
  - secure: A1mWBu4qNBz0aGG4dp+x176ipchIvdlydCJsuO7C0XN3hQLNAKKVxzjST6JOV2+D/h3yfRiAfrTO2VGOupy82Ke1Tcz75A+j5exBTZFzfCPc9CDeHC2mPPk4g/hkKre/pYxCCwx21hiPOsTHgsTOe2kqHRhHRiVigWCBLx9ZMWDqJRm0JyOBT8YoCJk2eTmY2AJ4gdTz9AxP/aVHWKKOXsbsVFVnjNqOtxZV5F2cryfGT1vpNJuGMki4Ef8kUP6ne3yplWIYafxejrZ6OfmDZInY5M2rZ49Tj6+juYTcg3Q/Qoesg6g2kd6QpzKajq04qEnyGm0tDvRdvQtzNOltDwzgtFm3BqQQvUfKRx/H8UOay1xAxLcg/Qnyr76VUR5JhdCn3iKSmX9LeHVHARNoWErqajQAI20Vs+hfPscdp8ztfka5QHLUPIG+HpXqlt681/AuNNLGEJcMN1zDteOs6vBxnSRfsa1tbjTMqN+YbO8tqoZgSq9KEz+0UJMZU3t8fd5KsNZpSIgRtTHbU9QTLswaIeMkByYoPDeqRi30rR8yWN7MLxYvxGoBorr5MNDP1WRH8yV+kQwsRp4nigsqEUsYYpjsORgYn8oYEtMHt4aG4gtkjHzd5BrnfktRtqdZnYidruX8V3CJGP0+C082dBguFYPDRBfgj3gI3GAzJoU=
  - secure: Q+Pa+OauPqOKCNAibiiYBgL1bvRTAexMAKTXZzVQKqs3rOwCtaZG4zXPmDriB8NSXzu2SeBvUT4G586pTaYnLf0m5t4uKEjX55CdqqYWjqnW4LaDeval7LRmLrTUNs/s6SDHk+LsGTvtMZcQ4/EIUYPmF0dKwqm+0ZYnkugrB7VVS5Bzg3bRCkLGicW/GxIcJdVhZHKwPfwHmt/t87VTww5xy0/ojHSMpLbfZ7siWeOGY2KpSHH0pjhi9ypJsVau1vajTFExYHYbEXtolA8pbV326k3eNt0XwB0gM8T7XEzlAcJpGOLGw7Ctqot4ZBxF5v8r8b/7AN/XWeoJBmPfx9imgYqGWWhBW9M758aHOCVrxxND25+LiDZO5BhdlOG1oevCxQoQZKa1jhfC8zAHlx7ABUBgcaVmleyKaiRelGQxKbVp8Nq26pblS8T8q+pF23rAsXXpuJNHMAzQBXwP+G57qm99GOyF4w7nh2hk7DbQ29BEjcgbj92lAKaQXkH5fiUDviQBhyNY5IVClT/vywZUVRLS9lCIvgVgBW91kHRFncSiUCUDOKKXth1ULIW461FUfo95oxruMCRU568omkNtjzMMxlQYPlvhS70j8tP/+8SD5rVhHkAyxcsheJWP5bTmhYuNsZ599wXpaCGkZkmmZ0PQu15xRc2hWbsk0ic=
  - secure: CsKo5YBO6AmkvKePA/HmJz0HOwaluJU8I+rgyMXYMQ9eK6/xxbiYwvmSqvh/gv4AJ43y9zoNzwfZXGFT/GPAlmff6GcBtknj3lPhp9mlKiKGIZHPIQHj2kYZlB/aabHqd4FktqWGZPitsfP4VwUO7iK3si8sNczxhhprL+v8oTRya8knXPCeBX4eIct7Og5p6PQryDk2MB0f/8yLaVe5ebBX5zTFOHYnNHcjYgr1fCFmCmfgYQy2KZqMHRDqhLwjfn0rPqixxV9PW86Bmbb46tuiewdYwGdkelYriR15KmhN0MV+pmK36eQzSJ1RMVM89/570z6Uvor84QWy1V1umRXj/t01YVgGrA0wkeBbEeDtuk9aq1nKjAkgiP4cztH5Y3+8fJr1bH+M0rGtt+mRAM+LgUgk5NnaBuHzl5z54JwO6b9RhhTYZwsT7KrEMjAmlJpb+nxa2zM4vWAIR91nuCQPjBZkR/eIS0LMWDge76282jMrWoL1EG+YbbIpshAXerIUy68h05lq6759XLK2IAENBaKxtzcSuhCuBqxbnMkdle23Yq7UwZAB1z3dXX5kOzB1CI+TNsgXKSEglXcrHU3yQHoK85sHjQHsA6phexTi2Fs18gZXN7BZG89by2iQXPl7aKDPx8h8coeNYMjp/b1XjKB08jMZiSe7nB5xpyQ=
  - secure: LWUKwgxdIguNo4/9e6aZ1wx32cEu+tlackqzIiiNGGyTHwaFxKzGSeip4iFut7YYAxw7J4uyBhDrFI3PGF3yaCixDdvjTUYTHULzIR496yAgizq+gpiL38mTi88YjOp/+hn2IJs8eFyPqRM99eCVTncczV/GuPbn8ekKd7f9oKhbbjuVKfiX1YyZku0GDvKfeEc4PkhYlGRXuiy2hbcBrrMpz/CjPCZ3bceRgrPxWag8NFInLhLPPFzWdms/mgrhh/+hoKz7s/byW6nIvrxNAH++cWEzR3ixA2vkas/NBhiwlJUeREsqksRc0ua1I05nwATw3nDmaODrisd07K9OxJHDJTcJGn24Dvs1P2kAjBjAVglRFVOadcO+k/ikZwlu968p9Sa0XpGlAis1yGE+qRQYsltTR065Gs6fJ+5g/ohH0OllnU6UwHUNOEAGntzL3LYYdfzMqDUtnVdLBpLt4Sx/OKfD6Vfd5Eiu2ITFHcNpwynd1AT44oxtWkzn4/b+DjOmSFQsXfEG++nZsGj4G5zLSnfZsJIqJ/WIvsHKC7fRx7929PvChCXPbcaGVRY06KVeMGECnTOMYE5vRdlEy6Zm1OluZbaXicdH7e7k8s2u0tRf9f5P5hinxAMUgZ1OEWqz83kw/6exwdwoh3dHMQ9qemoGz1P31vpQ7HkY4vg=
  - secure: U/Ujvlpkv3fgI89zUNlxLSQ5DyNxgAZlQk0EQirN8Sgy9bCn/kbMX3yzmWq9lXW/4w6xpXok2m1JMctyjuxtCYZe1eCY41c8nyu3h5N7IcR4pJoiqcpQ2dkwv6lwQMiYavG1krFA6VT26oBdli0+54pkWWGkZZ8JR9GocEIlmJw8JP8xUvYBpr9EGQ1yDIJgU+OKY5XzWoLM2rDTdbiDVXq7MUY5B9Vt7QNsqmsofRdHx2uaeMIxdHGVzwXwxjRYBG9cML0jrLTGuVFQeFl/ZZVn3c8Ev/1ykqzBykXU9EY+SYnWL2Ph0nn+SRb1xt82AoFnPb9HfP9bcIQstMK1zkQz/OByGZA5hJLrEJDeOHgv36csEa88TdusYSd8E8bEeIrVrAiyLCg3W6iz1U/q3G8nooydf3qPyc2iwHxBucFqjbU5nteFUUeqVf+/RrShbDHudfkY5mnGF3imrPaY7hJ+xijjfnOr0un24u3sVh9+UEiphKf+qdoivra34xspDtbQBCFOHxs5Rf8bNqRI7kyb6beJ927xV/lv50mVrOOo2YbbOD6/rdog8qQwJY5wQDRxmCJacyHlq3C8q7gc5pSe5WWzIi0lWLChUX6o3e6nOusji2xR/LivJcbnfqf6gaqOB6eQSNmXf09lOSG1grcAif1KGMOIxhVtgGTw0FU=
  - secure: fkVjhtVCOfnBzY/MnoW4eQnX/UKNUGUFyUXJFSlSSAUjUwGyBqNctOp7eyU6RLxtxFweVY6kLJQh0UM1q3GTbLo471TZtBGZ9NMwVjGLJxRxcBElaKc+TvugTwRwRqnrDfoyujXJ0MJHYAJRxAY9YW0vU8fh5ezc7eUWCxfbQPnPjhMzIMl7VCvnSKpBr6ROKMQp3GFsjRgLs+CY2sq5FXJIORk+OGdswD6lxFHFTo2Y1c00IbNbyM87uOCr6F9xYFCTRaQzJ5xkvc2N1ne+h69GHMcE91yt4QqZFHUlPc4ywDEN8CAxWhNgVMSXw0+v1+mMvlNTj57b1hIx/Zp0SW5s3y2KlvXZPaEVFJtlTSkkAdz4txxCzD/1FETkP0IMVq6Wkr80VtObSx6SaDBdRwPn0isl1sgvlrud092DOsjfCASgduT4IzfWwGbGHhzIOR1zFqfRPWDDcZHzTCEtsuKszIJ8NjomPNmWQpJmt26Igunpmev48/ZBo842117I7TSBnz7azMuzvvuWi3Sh6ksD9KYXp1WDWzXLrXmyWVkxSrnk2N6UdWuZkT4a03RQUvKteFjna1D7MhA4wIMi5h50ruPMsmzHvNSw2aXilkQ6ZM5Kh22GVjOjStqZmrrLYUETpIUUtxGthALQAZ8cUjOrq76bUemgX47R0kHEc58=
